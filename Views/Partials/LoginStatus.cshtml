@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@inject Umbraco.Cms.Core.Security.IMemberManager MemberManager
@using System.Text.Json

@{
    Layout = null;

    var member = await MemberManager.GetCurrentMemberAsync();
    var isLoggedIn = member != null;

    var welcomeName = member?.Name;

    var logoutUrl = Url.Content("~/umbraco/api/member/logout");
    var redirectAfterLogout = "/";

    var logoutUrlJson = JsonSerializer.Serialize(logoutUrl);
    var redirectAfterLogoutJson = JsonSerializer.Serialize(redirectAfterLogout);
}

<div class="login-status-wrapper">
    <div class="login-status">
        @if (isLoggedIn)
        {
            <p>Welcome to KINSEN HELLAS <strong>@welcomeName</strong>!</p>
            <button type="button" id="logoutBtn" class="btn btn-danger logoutBtn">
                Αποσύνδεση
            </button>
        }
        else
        {
            <a href="/login" class="btn btn-primary">Σύνδεση</a>
        }
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {

    const logoutBtn = document.getElementById('logoutBtn');
    if (!logoutBtn) return;

    logoutBtn.addEventListener('click', async function (e) {
        e.preventDefault();

        try {
            const r = await fetch(@Html.Raw(logoutUrlJson), {
                method: 'POST',
                credentials: 'include'
            });

            if (r.ok) {
                window.location.href = @Html.Raw(redirectAfterLogoutJson);
            } else {
                console.error('Logout failed');
            }
        } catch (err) {
            console.error('Logout error:', err);
        }
    });
});
</script>
