@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
<!DOCTYPE html>
<html lang="el" data-umbraco-page-id="@Model.Id">
<head>
    <meta charset="utf-8" />
    <title>@(ViewData["Title"] as string ?? (Model?.Name + " | kinsen.gr") ?? "Kinsen")</title>

    <meta name="viewport" content="width=device-width, initial-scale=1" /> <!-- responsive -->

    <!-- Fonts & libraries -->
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- ✅ Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom styles -->
    <link rel="stylesheet" href="~/css/main.css" /> 
    <link rel="stylesheet" href="~/css/navbar.css" />
    <link rel="stylesheet" href="~/css/footer.css" />
    <link rel="stylesheet" href="~/css/usedCarSales.css" />
    <link rel="stylesheet" href="~/css/warranty_Finance.css" />
    <link rel="stylesheet" href="~/css/contact.css" />
    <link rel="stylesheet" href="~/css/login.css" />
    <link rel="stylesheet" href="~/css/loginStatus.css" />
    <link rel="stylesheet" href="~/css/carDetailsMember.css" />
    <link rel="stylesheet" href="~/css/carDetailsVisitor.css" />
    <link rel="stylesheet" href="~/css/faq.css" />
    <link rel="stylesheet" href="~/css/contactPage.css" />
    <link rel="stylesheet" href="~/css/userSettings.css" />
    <link rel="stylesheet" href="~/css/getCode.css" />
    <link rel="stylesheet" href="~/css/scrollbar.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    @RenderSection("head", required: false)

</head>
<body class="@ViewBag.BodyClass">
    
    @await Html.PartialAsync("~/Views/Navbar.cshtml")

    <div class="layout-wrapper">
        <main class="main-content">
          @RenderBody()
        </main>
        @await Html.PartialAsync("~/Views/Footer.cshtml")
    </div>

    @RenderSection("scripts", required: false)

    <!-- ✅ ΜΟΝΟ το Bootstrap bundle (χειρίζεται navbar, dropdown, collapse) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Άλλα scripts -->
    <script src="~/js/countUpStats.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script>AOS.init();</script>

    <!-- OfferCart badge -->
    <script>

      (function () {
        const SELECTORS = ['#offerCartCount'];
        function findBadges() { return SELECTORS.flatMap(s => [...document.querySelectorAll(s)]); }
        function setBadge(n){ findBadges().forEach(el => el && (el.textContent = String(n))); }

        async function fetchCount() {
          try {
            const r = await fetch("/umbraco/api/cart/count", { cache: "no-store", credentials: "same-origin" });
            if (!r.ok) return 0;
            const { count } = await r.json();
            return Number.isFinite(count) ? count : 0;
          } catch { return 0; }
        }

        function whenBadgeReady(cb){
          if (findBadges().length) return cb();
          const obs = new MutationObserver(() => {
            if (findBadges().length){ obs.disconnect(); cb(); }
          });
          obs.observe(document.documentElement, { childList:true, subtree:true });
        }

        async function syncBadge(){ setBadge(await fetchCount()); }

        window.updateCartBadgeFromServer = () => whenBadgeReady(syncBadge);

        document.addEventListener("DOMContentLoaded", () => whenBadgeReady(syncBadge));
        window.addEventListener("pageshow", () => whenBadgeReady(syncBadge));

        window.addEventListener("cart:updated", ev => {
          const c = ev.detail?.count;
          if (typeof c === "number") setBadge(c); else whenBadgeReady(syncBadge);
        });
      })();

    </script>
</body>
</html>
