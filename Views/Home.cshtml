@using Umbraco.Cms.Core.Models.Blocks;
@using Umbraco.Cms.Core.Models; 
@using Umbraco.Cms.Web.Common.PublishedModels;
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
	
    var pageTitle = Model.Value<string>("pageTitle");
    var carVideo = Model.Value<Umbraco.Cms.Core.Models.PublishedContent.IPublishedContent>("homeVideo");
    var videoUrl = carVideo?.Url();
    @* var homeImage = Model.Value<IPublishedContent>("homeImage"); *@
    var heroHeader = Model.Value<string>("heroHeader");
    var heroDescription = Model.Value<string>("heroDescription");
	var blockListItem = Model.Value<IEnumerable<BlockListItem>>("statsItem");
    var paragr = Model.Value<string>("paragr");
    var carCardBlock = Model.Value<IEnumerable<BlockListItem>>("carouselCars");
    var total = carCardBlock?.Count() ?? 0;
    var photoTrilogy = Model.Value<IEnumerable<BlockListItem>>("photoTrilogy");
    var trilogyBlock = Model.Value<IEnumerable<BlockListItem>>("trilogyBlock");
	var featureCardsBlock = Model.Value<IEnumerable<BlockListItem>>("featureCard");
    var redirectUrl = "/πωλήσεις-μεταχειρισμένων/"; 
	@* var fourStepsBlock = Model.Value<IEnumerable<BlockListItem>>("fourSteps"); *@
	var accordionQuestionsBlock = Model.Value<IEnumerable<BlockListItem>>("accordionQuestions");
    var index = 0;
}

<div class="hero-wrapper">
    @if (!string.IsNullOrWhiteSpace(videoUrl))
    {
        <video class="hero-video" autoplay muted loop playsinline>
            <source src="@videoUrl" type="video/mp4" />
            Το βίντεο δεν υποστηρίζεται από τον browser σας.
        </video>
    }
    <div class="hero-overlay">
        <h1 class="hero-title">@pageTitle</h1>
    </div>
</div>


@*-----------------Animation Counter----------------*@
<section class="stats-section">
    <div class="stats-row">
        <div class="stat-box">
            <div class="stat-number" data-target="200" data-plus="true" data-unit="">0</div>
            <div class="stat-label">
                @(blockListItem?.ElementAtOrDefault(0)?.Content?.Value("statLabel"))
            </div>
        </div>

        <div class="stat-box">
            <div class="stat-number" data-target="300" data-plus="true" data-unit="">0</div>
            <div class="stat-label">
                @(blockListItem?.ElementAtOrDefault(1)?.Content?.Value("statLabel"))
            </div>
        </div>

        <div class="stat-box">
            <div class="stat-number" data-target="900" data-plus="false" data-unit="χλμ">0</div>
            <div class="stat-label">
                @(blockListItem?.ElementAtOrDefault(2)?.Content?.Value("statLabel"))
            </div>
        </div>
    </div>

    @if (!string.IsNullOrWhiteSpace(paragr?.ToString()))
    {
        <div class="stats-paragr">
            @Html.Raw(paragr)
        </div>
    }
</section>

@*---------------Feature Cards---------------*@
@if (featureCardsBlock != null && featureCardsBlock.Any())
{
    <h2 class="featureTitle">Επιλέξτε ανάμεσα σε ποικιλία κατηγοριών</h2>

    <div class="features-container">
        @foreach (var card in featureCardsBlock)
        {
            var content = card.Content;
            var icon = content.Value<string>("icon"); 
            var description = content.Value<string>("description");
            var targetSlug = content.Value<string>("targetSlug") ?? "";

            <a href="/πωλήσεις-μεταχειρισμένων?carType=@targetSlug" onclick="selectCategory('@targetSlug')" class="feature-card-link">
                <div class="feature-card">
                    <div class="feature-icon">
                        <p>@Html.Raw(icon)</p>
                    </div>
                    <div class="feature-description">
                        <p>@Html.Raw(description)</p>
                    </div>
                </div>
            </a>
        }
    </div>
}

@*------------------Carousel-------------------*@
<h2 class="prosfores" style="color:#39c0c3; font-weight:bold">Ανακαλύψτε τις Προσφορές σε ποικιλία μοντέλων</h2>
<div class="d-flex justify-content-center mt-5 container-xl">
    <div id="carouselExampleDark" class="carousel carousel-dark slide shadow-lg"
         data-bs-ride="carousel"
         style="max-width: 1800px; height:auto; width: 100%; border-radius: 1.5rem; overflow: hidden;">
         
        @if (carCardBlock != null && carCardBlock.Any())
        {
            <div class="carousel-indicators">
                @for (var i = 0; i < carCardBlock.Count(); i++)
                {
                    <button type="button"
                            data-bs-target="#carouselExampleDark"
                            data-bs-slide-to="@i"
                            class="@(i == 0 ? "active" : "")"
                            aria-current="@(i == 0 ? "true" : "false")"
                            aria-label="Slide @(i + 1)">
                    </button>
                }
            </div>

            <div class="carousel-inner">
                @foreach (var card in carCardBlock)
                {
                    var content = card?.Content;
                    if (content == null) { continue; } // skip αν είναι null

                    var carPic = content.Value<Umbraco.Cms.Core.Models.MediaWithCrops>("carPic");
                    var modelo = content.Value<string>("model");
                    var typeOfDiscount = content.Value<string>("typeOfDiscount");
                    var yearRelease = content.Value<string>("yearRelease");
                    var price = content.Value<string>("price");
                    var km = content.Value<string>("km");

                    <div class="carousel-item @(index == 0 ? "active" : "")"
                        data-bs-interval="5000"
                        data-offer-type="@typeOfDiscount?.ToLowerInvariant()">

                        @if (!string.IsNullOrWhiteSpace(typeOfDiscount))
                        {
                            <span class="discount-badge">@typeOfDiscount</span>
                        }

                        <div class="carousel-media">
                            <img src="@carPic?.Url()" alt="@modelo" loading="lazy">
                        </div>

                        <div class="p-4 text-center bg-light rounded-bottom shadow-sm">
                            <h5>@(string.IsNullOrWhiteSpace(modelo) ? "Χωρίς Μοντέλο" : modelo)</h5>
                            <p>@(string.IsNullOrWhiteSpace(yearRelease) ? "—" : yearRelease) – @(string.IsNullOrWhiteSpace(km) ? "—" : km) km</p>
                            <p class="fw-bold">@(string.IsNullOrWhiteSpace(price) ? "—" : price + " €")</p>
                        </div>
                    </div>
                    index++;
                }
            </div>
        }
        else
        {
            <p class="text-muted">Δεν υπάρχουν διαθέσιμες κάρτες.</p>
        }

        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
</div>

@*----------------Photo Trilogy------------------*@
<section class="gallery-bg">
    @* @if (!string.IsNullOrWhiteSpace(videoUrl))
    {
        <div class="video-container">
            <video class="hero-video" autoplay muted loop playsinline>
                <source src="@videoUrl" type="video/mp4" />
                Το βίντεο δεν υποστηρίζεται από τον browser σας.
            </video>
        </div>
    } *@

    @if (photoTrilogy != null && photoTrilogy.Any())
    {
        foreach (var item in photoTrilogy)
        {
            var content = item.Content;

            var trilogyPhoto1 = content.Value<MediaWithCrops>("trilogyPhoto1");
            var trilogyPhoto2 = content.Value<MediaWithCrops>("trilogyPhoto2");
            var trilogyPhoto3 = content.Value<MediaWithCrops>("trilogyPhoto3");

            <div class="photo-trilogy-container">
                <div class="main-photo">
                    <img src="@trilogyPhoto1?.Url()" alt="Main Photo" />
                </div>
                <div class="side-photos">
                    <img src="@trilogyPhoto2?.Url()" alt="Side Photo 1" />
                    <img src="@trilogyPhoto3?.Url()" alt="Side Photo 2" />
                </div>
            </div>
        }
    }

    @if (trilogyBlock != null && trilogyBlock.Any())
    {
        <div class="photo-trilogy-container">
            @foreach (var item in trilogyBlock)
            {
                var content = item.Content;
                var title = content.Value<string>("titleCard");
                var description = content.Value<string>("cardBody");

                <div class="trilogy-text-block">
                    <h3>@title</h3>
                    <p>@Html.Raw(description)</p>
                </div>
            }
        </div>
    }
</section>

@*---------------4 Steps------------------*@
@* <section class="steps-section">
    <h2 class="steps-title">Πώς λειτουργεί</h2>
    @if (fourStepsBlock != null && fourStepsBlock.Any())
    {
        <div class="steps-wrapper">
            
            @foreach (var step in fourStepsBlock)
            {
                var content = step.Content;
                var iconStep = content.Value<string>("iconStep");
                var titleStep = content.Value<string>("titleStep");
                var descriptionStep = content.Value<string>("descriptionStep");
                <div class="step-card">
                    <div class="step-icon">
                        @Html.Raw(iconStep)
                        <h4 class="step-text-header">@Html.Raw(titleStep)</h4>
                    </div>
                    <p class="step-text-par">@Html.Raw(descriptionStep)</p>
                </div>
            }
        </div>
    }
</section> *@

@*---------------Accordion-------------------*@
<h2 class="steps-title" style="color:#002e4d; margin-top:30px;">Συχνές Ερωτήσεις</h2>
<section class="accordion-wrapper">
	
    @if (accordionQuestionsBlock != null && accordionQuestionsBlock.Any())
    {
        <div class="custom-accordion" id="faqAccordion">
            @foreach (var item in accordionQuestionsBlock.Select((val, idx) => new { val, idx }))
            {
                var content = item.val.Content;
                var accordionTitle = content.Value<string>("accordionTitle");
                var accordionContent = content.Value<string>("accordionContent");
                var id = $"accordion-item-{item.idx}";
                var collapseId = $"collapse-{item.idx}";
                var headingId = $"heading-{item.idx}";
                
                <div class="accordion-item">
                    <h2 class="accordion-header" id="@headingId">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#@collapseId" aria-expanded="false" aria-controls="@collapseId">
                            @accordionTitle
                        </button>
                    </h2>
                    <div id="@collapseId" class="accordion-collapse collapse" aria-labelledby="@headingId" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            @Html.Raw(accordionContent)
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</section>

<script>
  function selectCategory(type) {
    sessionStorage.setItem("selectedCarType", type);
    window.location.href = "/πωλήσεις-μεταχειρισμένων"; 
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
